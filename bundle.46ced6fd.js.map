{"version":3,"sources":["src/script/router.ts","src/script/routerVisualisation.ts","src/script/bundle.ts"],"names":[],"mappings":"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","file":"bundle.46ced6fd.js","sourceRoot":"..","sourcesContent":["// eslint-disable-next-line no-unused-vars\ntype LinkPathCreator = (...params: any[]) => string;\n// eslint-disable-next-line no-unused-vars\ntype VoidFunc = (...params: any[]) => void;\n\ntype AbstractListener = {\n  url: string | RegExp | (() => string);\n  onBeforeEnter: VoidFunc;\n  onEnter: VoidFunc;\n  onLeave: VoidFunc;\n  render: VoidFunc;\n};\n\ntype AbstractState = Record<string, any>;\n\nexport class Router {\n  private _listeners: AbstractListener[];\n  private _currentID: string;\n  private _states: Record<string, AbstractState>;\n  private _forward: boolean;\n\n  private _findNeedURLs(url: string) {\n    return this._listeners.filter((el: AbstractListener) => {\n      const innerURL = el.url;\n      if (innerURL instanceof RegExp) {\n        return url.match(innerURL) ? true : false;\n      }\n\n      const stringURL = innerURL instanceof Function ? innerURL() : innerURL;\n      return stringURL === url ? true : false;\n    });\n  }\n\n  constructor() {\n    this._listeners = [];\n    this._currentID = String(+new Date());\n    this._states = {};\n    this._states[this._currentID] = {\n      url: \"\",\n      onBeforeEnterArgs: null,\n      onEnterArgs: null,\n      onLeaveArgs: null,\n    };\n    this._forward = true;\n\n    window.addEventListener(\"popstate\", async (e) => {\n      let listeners = this._findNeedURLs(this._states[this._currentID].url);\n      if (e.isTrusted) {\n        if (!(this._states[this._currentID] && this._states[e.state.id])) {\n          return;\n        }\n\n        this._forward = Number(this._currentID) < Number(e.state.id);\n\n        for (let i = 0; i < listeners.length; i++) {\n          await listeners[i].onLeave(\n            this._forward,\n            ...this._states[this._currentID].onLeaveArgs\n          );\n        }\n\n        this._currentID = e.state.id;\n\n        listeners = this._findNeedURLs(this._states[this._currentID].url);\n        for (let i = 0; i < listeners.length; i++) {\n          await listeners[i].onBeforeEnter(\n            this._forward,\n            ...this._states[this._currentID].onBeforeEnterArgs\n          );\n        }\n\n        window.dispatchEvent(new Event(\"popstate\"));\n      } else {\n        for (let i = 0; i < listeners.length; i++) {\n          await listeners[i].render(\n            this._forward,\n            ...this._states[this._currentID].renderArgs\n          );\n        }\n\n        listeners = this._findNeedURLs(this._states[this._currentID].url);\n        for (let i = 0; i < listeners.length; i++) {\n          await listeners[i].onEnter(\n            this._forward,\n            ...this._states[this._currentID].onEnterArgs\n          );\n        }\n      }\n    });\n  }\n\n  async go(\n    url: string,\n    onBeforeEnterArgs: any[],\n    onEnterArgs: any[],\n    onLeaveArgs: any[],\n    renderArgs: any[]\n  ) {\n    this._forward = true;\n\n    let listeners = this._findNeedURLs(this._states[this._currentID].url);\n    for (let i = 0; i < listeners.length; i++) {\n      await listeners[i].onLeave(\n        true,\n        ...this._states[this._currentID].onLeaveArgs\n      );\n    }\n\n    const id = String(+new Date());\n    this._states[id] = {\n      url: url,\n      onBeforeEnterArgs: onBeforeEnterArgs,\n      onEnterArgs: onEnterArgs,\n      onLeaveArgs: onLeaveArgs,\n      renderArgs: renderArgs,\n    };\n\n    listeners = this._findNeedURLs(url);\n    for (let i = 0; i < listeners.length; i++) {\n      await listeners[i].onBeforeEnter(true, ...onBeforeEnterArgs);\n    }\n\n    this._currentID = id;\n\n    history.pushState({ id: id }, url, url);\n    window.dispatchEvent(new Event(\"popstate\"));\n  }\n\n  on(\n    url: string | RegExp | LinkPathCreator,\n    onBeforeEnter: VoidFunc,\n    onEnter: VoidFunc,\n    onLeave: VoidFunc,\n    render: VoidFunc\n  ) {\n    this._listeners.push({\n      url: url,\n      onBeforeEnter: onBeforeEnter,\n      onEnter: onEnter,\n      onLeave: onLeave,\n      render: render,\n    });\n  }\n}\n","import { Router } from \"./router\";\n\n//randomly async or sync hooks will be created\nexport const getRandomColor = () => {\n  const rndR = ((Math.random() * 7 + 6) | 0).toString(16);\n  const rndG = ((Math.random() * 7 + 6) | 0).toString(16);\n  const rndB = ((Math.random() * 7 + 6) | 0).toString(16);\n  return `#${rndR}${rndG}${rndB}`;\n};\n\nexport const renderCreator = (pClass: string) => {\n  return (...params: any[]) => {\n    const logDiv = document.getElementById(\"logs\") as HTMLDivElement;\n    const p = document.createElement(\"p\");\n    p.innerHTML = `Rendering page ${location.href.replace(\n      location.origin,\n      \"\"\n    )} from the link \"${params[1]}\"`;\n    p.classList.add(pClass);\n    p.style[\"background-color\" as unknown as number] = params[2];\n    logDiv.appendChild(p);\n  };\n};\n\n//randomly async or sync hooks will be created\nexport const hooksCreator = (outText: string, syncAsync = 0.5) => {\n  return Math.random() < syncAsync\n    ? (...params: any[]) => {\n        const logDiv = document.getElementById(\"logs\") as HTMLDivElement;\n        const p = document.createElement(\"p\");\n        if (outText === \"onBeforeEnter()\") {\n          p.innerHTML = params[0]\n            ? `let's call ${outText} and go FORWARD to the page ${params[1]}`\n            : `let's call ${outText} and go BACK to the page ${params[1]}`;\n        } else {\n          p.innerHTML =\n            outText === \"onEnter()\"\n              ? `let's call ${outText} and please work with the page ${params[1]}`\n              : `let's call ${outText} and say goodbue to the page ${params[1]}`;\n        }\n        p.classList.add(\"log-container__text\");\n        p.style[\"background-color\" as unknown as number] = params[2];\n        logDiv.appendChild(p);\n      }\n    : (...params: any[]) => {\n        return new Promise((resolve) => {\n          setTimeout(() => {\n            const logDiv = document.getElementById(\"logs\") as HTMLDivElement;\n            const p = document.createElement(\"p\");\n            if (outText === \"onBeforeEnter()\") {\n              p.innerHTML = params[0]\n                ? `let's call ASYNC ${outText} and go FORWARD to the page ${params[1]}`\n                : `let's call ASYNC ${outText} and go BACK to the page ${params[1]}`;\n            } else {\n              p.innerHTML =\n                outText === \"onEnter()\"\n                  ? `let's call ASYNC ${outText} and please work with the page ${params[1]}`\n                  : `let's call ASYNC ${outText} and say goodbue to the page ${params[1]}`;\n            }\n            p.classList.add(\"log-container__text\");\n            p.style[\"background-color\" as unknown as number] = params[2];\n            logDiv.appendChild(p);\n            resolve(\"async operation end\");\n          }, 100);\n        });\n      };\n};\n\nexport const startVisualisation = (syncAsync: number) => {\n  const router = new Router();\n\n  const allA = document.querySelectorAll(\"a\");\n  allA &&\n    allA.forEach((a: HTMLAnchorElement) => {\n      a.addEventListener(\"click\", (e: MouseEvent) => {\n        const nextPath = (e.target as HTMLAnchorElement).href.replace(\n          location.origin,\n          \"\"\n        );\n        const bgColor = getRandomColor();\n        router.go(\n          nextPath,\n          [nextPath, bgColor],\n          [nextPath, bgColor],\n          [nextPath, bgColor],\n          [(e.target as HTMLAnchorElement).innerHTML, bgColor]\n        );\n        e.preventDefault();\n      });\n    });\n\n  router.on(\n    new RegExp(\"^/otus-learning/[a-zA-z]+[0-9]*$\"),\n    hooksCreator(\"onBeforeEnter()\", syncAsync),\n    hooksCreator(\"onEnter()\", syncAsync),\n    hooksCreator(\"onLeave()\", syncAsync),\n    renderCreator(\"log-container__text\")\n  );\n  router.on(\n    () => \"/otus-learning/_Link_\",\n    hooksCreator(\"onBeforeEnter()\", syncAsync),\n    hooksCreator(\"onEnter()\", syncAsync),\n    hooksCreator(\"onLeave()\", syncAsync),\n    renderCreator(\"log-container__text--dotted\")\n  );\n  router.on(\n    \"/otus-learning/\",\n    hooksCreator(\"onBeforeEnter()\", syncAsync),\n    hooksCreator(\"onEnter()\", syncAsync),\n    hooksCreator(\"onLeave()\", syncAsync),\n    renderCreator(\"log-container__text--bordered\")\n  );\n\n  document.body.onload = () => {\n    const bgColor = getRandomColor();\n    const nextPath = location.href.replace(location.origin, \"\");\n    router.go(\n      nextPath,\n      [nextPath, bgColor],\n      [nextPath, bgColor],\n      [nextPath, bgColor],\n      [\"reloaded page\", bgColor]\n    );\n  };\n};\n","import \"../scss/reset.scss\";\nimport \"../scss/style.scss\";\n\nimport { startVisualisation } from \"./routerVisualisation\";\n\nstartVisualisation(0.5);\n"]}